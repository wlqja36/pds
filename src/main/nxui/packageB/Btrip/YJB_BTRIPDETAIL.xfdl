<?xml version="1.0" encoding="utf-8"?>
<FDL version="1.5">
  <TypeDefinition url="..\default_typedef.xml"/>
  <Form id="YJB_BTRIPMANAGER" left="0" top="0" width="1280" height="670" titletext="New Form" onload="form_onload">
    <Layouts>
      <Layout>
        <ImageViewer id="ImageViewer03" taborder="91" left="20" top="424" width="1235" height="237" style="background:#d8dcedff;border:1 solid #969696ff ;"/>
        <ImageViewer id="ImageViewer01" taborder="90" left="20" top="89" width="1235" height="290" style="background:#d8dcedff;border:1 solid #969696ff ;"/>
        <ImageViewer id="ImageViewer00" taborder="0" left="7" top="8" width="1265" height="45" style="background:#165fa6ff;"/>
        <Static id="sta_btr" taborder="1" text="출장관리" onclick="Static00_onclick" left="16" top="11" width="352" height="40" style="color:#ffffffff;align:left middle;font:bold 16 Arial Black;"/>
        <Static id="Static23" taborder="8" onclick="Static05_onclick" left="24" top="308" width="1228" height="33" style="background:#f0f0f0ff;border:1 solid #969696ff ;bordertype:normal 0 0 ;align:center middle;font:bold 20 Dotum;"/>
        <Static id="Static19" taborder="9" onclick="Static05_onclick" left="24" top="217" width="1228" height="92" style="background:#f0f0f0ff;border:1 solid #969696ff ;bordertype:normal 0 0 ;align:center middle;font:bold 20 Dotum;"/>
        <Static id="Static10" taborder="10" onclick="Static05_onclick" left="24" top="340" width="1228" height="33" style="background:#f0f0f0ff;border:1 solid #969696ff ;bordertype:normal 0 0 ;align:center middle;font:bold 20 Dotum;"/>
        <Static id="Static07" taborder="11" onclick="Static05_onclick" left="24" top="94" width="1228" height="33" style="background:#f0f0f0ff;border:1 solid #969696ff ;bordertype:normal 0 0 ;align:center middle;font:bold 20 Dotum;"/>
        <Static id="sta_btr_mNum" taborder="13" text="출장관리번호" onclick="Static06_onclick" left="24" top="94" width="139" height="33" style="background:#f4edfaff;border:1 solid #969696ff ;color:#000080ff;bordertype:normal 0 0 ;align:center middle;font:bold 9 Dotum;"/>
        <Static id="sta_btr_lodgment" taborder="19" text="숙박" onclick="Static06_onclick" left="24" top="340" width="139" height="33" style="background:#f4edfaff;border:1 solid #969696ff ;color:#000080ff;bordertype:normal 0 0 ;align:center middle;font:bold 9 Dotum;"/>
        <Static id="sta_btr_traffic" taborder="20" text="교통" left="334" top="340" width="139" height="33" style="background:#f4edfaff;border:1 solid #969696ff ;color:#000080ff;bordertype:normal 0 0 ;align:center middle;font:bold 9 Dotum;"/>
        <Edit id="edt_btr_traffic" taborder="21" left="482" top="346" width="151" height="21" style="font:9 Dotum;" maxlength="100"/>
        <Static id="sta_btr_visit" taborder="22" text="방문처" left="641" top="340" width="139" height="33" style="background:#f4edfaff;border:1 solid #969696ff ;color:#000080ff;bordertype:normal 0 0 ;align:center middle;font:bold 9 Dotum;"/>
        <Edit id="edt_btr_visit" taborder="23" left="786" top="346" width="151" height="21" style="font:9 Dotum;" maxlength="100"/>
        <Static id="sta_btr_expense" taborder="24" text="예상경비" left="946" top="340" width="139" height="33" style="background:#f4edfaff;border:1 solid #969696ff ;color:#000080ff;bordertype:normal 0 0 ;align:center middle;font:bold 9 Dotum;"/>
        <Edit id="edt_btr_lodgment" taborder="25" left="174" top="346" width="151" height="21" style="font:9 Dotum;" maxlength="100"/>
        <Static id="Static08" taborder="26" text="*" left="44" top="87" width="16" height="47" style="color:red;font:15 arial;"/>
        <Static id="sta_btr_etc" taborder="31" text="비고" onclick="Static06_onclick" left="24" top="217" width="139" height="92" style="background:#f4edfaff;border:1 solid #969696ff ;color:#000080ff;bordertype:normal 0 0 ;align:center middle;font:bold 9 Dotum;"/>
        <Static id="sta_btr_startDate" taborder="34" text="업무시작일" onclick="Static06_onclick" left="24" top="308" width="139" height="33" style="background:#f4edfaff;border:1 solid #969696ff ;color:#000080ff;bordertype:normal 0 0 ;align:center middle;font:bold 9 Dotum;"/>
        <Static id="sta_btr_endDate" taborder="35" text="업무종료일" left="334" top="308" width="139" height="33" style="background:#f4edfaff;border:1 solid #969696ff ;color:#000080ff;bordertype:normal 0 0 ;align:center middle;font:bold 9 Dotum;"/>
        <Static id="Static26" taborder="37" left="641" top="308" width="611" height="33" style="background:#f4edfaff;border:1 solid #969696ff ;color:#000080ff;bordertype:normal 0 0 ;align:center middle;font:bold 9 Dotum;"/>
        <Static id="sta_btr_dList" taborder="44" text="출장관리상세내역" onclick="Static02_onclick" left="25" top="54" width="255" height="38" style="font:bold 14 Dotum;"/>
        <Edit id="edt_btr_mNum" taborder="46" enable="true" left="177" top="100" width="418" height="21" style="font:9 Dotum;" readonly="true"/>
        <TextArea id="TextArea_btr_etc" taborder="59" left="174" top="220" width="1070" height="85" maxlength="255"/>
        <Calendar id="cal_btr_startDate" taborder="62" left="174" top="314" width="150" height="21" displaynulltext="2021-00-00" locale="ko_KR" value="null" dateformat="yyyy-MM-dd ddd"/>
        <Calendar id="cal_btr_endDate" taborder="64" left="482" top="314" width="150" height="21" displaynulltext="2021-00-00"/>
        <Button id="btn_btr_save" taborder="70" text="등록" left="1093" top="390" width="76" height="27" style="background:URL('img::btn_imgs.png') stretch 0,0;border:0 solid #999999ff ;color:#ffffffff;bordertype:round 3 3 ;align:center middle;font:bold 15 Stencil;gradation:linear 0,0 #fefefeff 0,0 #ecece5ff;" onclick="btn_btr_save_onclick"/>
        <Button id="btn_btr_delete" taborder="72" text="삭제" left="1177" top="390" width="76" height="27" style="background:URL('img::btn_imgs.png') stretch 0,0;border:0 solid #999999ff ;color:#ffffffff;bordertype:round 3 3 ;align:center middle;font:bold 15 Stencil;gradation:linear 0,0 #fefefeff 0,0 #ecece5ff;" onclick="btn_btr_delete_onclick"/>
        <Button id="btn_btr_add" taborder="73" text="추가" left="1007" top="390" width="76" height="27" style="background:URL('img::btn_imgs.png') stretch 0,0;border:0 solid #999999ff ;color:#ffffffff;bordertype:round 3 3 ;align:center middle;font:bold 15 Stencil;gradation:linear 0,0 #fefefeff 0,0 #ecece5ff;" onclick="btn_btr_add_onclick"/>
        <Static id="sta_btr_scNum" taborder="74" text="출장일정번호" onclick="Static06_onclick" left="641" top="94" width="139" height="33" style="background:#f4edfaff;border:1 solid #969696ff ;color:#000080ff;bordertype:normal 0 0 ;align:center middle;font:bold 9 Dotum;"/>
        <Edit id="edt_btr_scNum" taborder="76" readonly="true" left="788" top="100" width="418" height="21" style="font:9 Dotum;"/>
        <Button id="fn_search03" taborder="75" onclick="fn_search_onclick" cssclass="btn_WF_SearchSmall" left="1217" top="100" width="26" height="21"/>
        <Static id="Static16" taborder="77" text="*" left="661" top="87" width="16" height="47" style="color:red;font:15 arial;"/>
        <Static id="Static03" taborder="78" onclick="Static05_onclick" left="24" top="126" width="1228" height="92" style="background:#f0f0f0ff;border:1 solid #969696ff ;bordertype:normal 0 0 ;align:center middle;font:bold 20 Dotum;"/>
        <Static id="sta_btr_mainSc" taborder="79" text="주요일정내용" onclick="Static06_onclick" left="24" top="126" width="139" height="92" style="background:#f4edfaff;border:1 solid #969696ff ;color:#000080ff;bordertype:normal 0 0 ;align:center middle;font:bold 9 Dotum;"/>
        <TextArea id="textArea_btr_mainSc" taborder="80" left="174" top="129" width="1070" height="85" maxlength="255"/>
        <Grid id="grd_btr_dlist" taborder="81" nodatatext="데이터가 없습니다." left="24" top="427" width="1228" height="229" style="font:bold 9 Dotum;" binddataset="ds_user">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="248"/>
                <Column size="251"/>
                <Column size="248"/>
                <Column size="240"/>
                <Column size="240"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell style="font:bold 14 dotum;" text="출장관리번호"/>
                <Cell col="1" style="font:bold 14 dotum;" text="출장일정번호"/>
                <Cell col="2" style="font:bold 14 dotum;" text="출장일정내용"/>
                <Cell col="3" style="font:bold 14 dotum;" text="업무시작일"/>
                <Cell col="4" style="font:bold 14 dotum;" text="업무종료일"/>
              </Band>
              <Band id="body">
                <Cell text="bind:btrip_Dno"/>
                <Cell col="1" text="bind:btrip_Dda"/>
                <Cell col="2" text="bind:detail"/>
                <Cell col="3" text="bind:ws_Date"/>
                <Cell col="4" text="bind:wf_Date"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <MaskEdit id="edt_btr_expense" taborder="92" left="1094" top="346" width="149" height="21" mask="+#,###"/>
      </Layout>
    </Layouts>
    <Objects>
      <Dataset id="ds_user" firefirstcount="0" firenextcount="0" useclientlayout="false" updatecontrol="true" enableevent="true" loadkeymode="keep" loadfiltermode="keep" reversesubsum="false">
        <ColumnInfo>
          <Column id="btrip_Dno" type="STRING" size="12"/>
          <!--<Column id="btrip_no" type="STRING" size="12"/>-->
          <Column id="btrip_Dda" type="STRING" size="12"/>
          <Column id="detail" type="STRING" size="255"/>
          <Column id="ws_Date" type="DATE" size="12"/>
          <Column id="wf_Date" type="DATE" size="12"/>
          <Column id="hotel" type="STRING" size="100"/>
          <Column id="trans" type="STRING" size="100"/>
          <Column id="visiter" type="STRING" size="100"/>
          <Column id="tex_Expenses" type="INT" size="10"/>
          <Column id="remark" type="STRING" size="255"/>
        </ColumnInfo>
        <Rows>
          <Row/>
        </Rows>
      </Dataset>
      <Dataset id="ds_search">
        <ColumnInfo>
          <Column id="searchCondition" type="STRING" size="256"/>
          <Column id="searchKeyword" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="searchKeyword"/>
            <Col id="searchCondition"/>
          </Row>
        </Rows>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="item1" compid="edt_btr_scNum" propid="value" datasetid="ds_user" columnid="btrip_Dda"/>
      <BindItem id="item2" compid="textArea_btr_mainSc" propid="value" datasetid="ds_user" columnid="detail"/>
      <BindItem id="item3" compid="TextArea_btr_etc" propid="value" datasetid="ds_user" columnid="remark"/>
      <BindItem id="item4" compid="cal_btr_startDate" propid="value" datasetid="ds_user" columnid="ws_Date"/>
      <BindItem id="item0" compid="edt_btr_mNum" propid="value" datasetid="ds_search" columnid="searchKeyword"/>
      <BindItem id="item5" compid="cal_btr_endDate" propid="value" datasetid="ds_user" columnid="wf_Date"/>
      <BindItem id="item6" compid="edt_btr_lodgment" propid="value" datasetid="ds_user" columnid="hotel"/>
      <BindItem id="item7" compid="edt_btr_traffic" propid="value" datasetid="ds_user" columnid="trans"/>
      <BindItem id="item8" compid="edt_btr_visit" propid="value" datasetid="ds_user" columnid="visiter"/>
      <BindItem id="item9" compid="edt_btr_expense" propid="value" datasetid="ds_user" columnid="tex_Expenses"/>
    </Bind>
    <Script type="xscript5.0"><![CDATA[include "Lib::Comm.xjs";


var rowNum = "";
this.form_onload = function(obj:Form, e:nexacro.LoadEventInfo)
{
	//기본 공통  함수 초기화
	Iject.formOnload(obj);
	

 		var strParam1 = this.parent.param1;
 		this.edt_btr_mNum.set_value(strParam1);
		this.fn_search_onclick();
		

} 
//조회처리
this.fn_search_onclick = function(obj:Button,  e:nexacro.ClickEventInfo)
{
  
    var searchKeyword = this.edt_btr_mNum.value; 
	this.ds_search.setColumn(0, "searchKeyword", searchKeyword);
   
   var oDatas =  {
			  svcid : "search",
			  sController : "YJB_btrDetailSelectVO.do",			 
			  inds :["ds_search=ds_search"],
			  outds :[
				 "ds_user=output"
			     ],			     
			  args  : [				
			  ],
			  bAsync : true,    // 비동기여부 (true : async  false: sync)
			  nDataType : 0,   // (0: XML타입, 1: 이진 타입, 2: SSV 타입)
			  bCompress :false,	 //			  
			}; 
	 trace(" this.ds_search : " + this.ds_search.saveXML());
	 
	 
    //공통 transaction 함수 호츨   //function callback 
	Iject.transaction(this,oDatas,function(){   
		if(this.errorcode < 0)
		{
		   Iject.alert(this.errorMsg);			
		   return;
		} 
	      
	       var pThis = this.fobj;   //form object	     
	         pThis.grd_btr_dlist.selectCell(rowNum);
	       trace(" ds_user : " + this.ds_user.saveXML());
	});
}


//저장버튼 누를시
this.btn_btr_save_onclick = function(obj:Button, e:nexacro.ClickEventInfo)
{
	if(this.textArea_btr_mainSc.value==null ){
		this.alert("주요 일정 내용을 확인해주세요");
		this.textArea_btr_mainSc.setFocus();
		return;
	}else if(this.cal_btr_startDate.value==null ){
		this.alert("업무 시작일을 확인해주세요");
		this.cal_btr_startDate.setFocus();
		return;
	}else if(this.cal_btr_endDate.value==null ){
		this.alert("업무 종료일을 확인해주세요");
		this.cal_btr_endDate.setFocus();
		return;
	}
	else if(this.edt_btr_visit.value==null ){
		this.alert("방문처를 확인해주세요");
		this.edt_btr_visit.setFocus();
		return;
	}
	else if(this.edt_btr_expense.value==null ){
		this.alert("예상 경비를 확인해주세요");
		this.edt_btr_expense.setFocus();
		return;
	}
	this.fn_save("save");
}

//저장
this.fn_save = function(strid)
{

//       var searchCondition =  "NAME";
//     var searchKeyword = this.edt_btrip_dno.value;       
// 	this.ds_search.setColumn(0, "searchCondition", "NAME");
	//this.ds_user.setColumn(this.ds_user.rowposition, "btrip_Dno", this.edt_btr_mNum.value);
   	
	
	var confirmStr = "";
	if(strid=="delete"){
		confirmStr = this.confirm("삭제하시겠습니까?");
	}else if(strid=="save"){
		confirmStr = this.confirm("저장하시겠습니까?");
	}
	if(confirmStr){
		
		rowNum = this.ds_user.rowposition;
		
		var oDatas =  {
				svcid : strid,
				sController : "YJB_btrDetailModifyVO.do",			 
				inds :["input=ds_user:U"],
				outds :[
					"ds_user=output"
					],			     
				args  : [				
				],
				bAsync : true,    // 비동기여부 (true : async  false: sync)
				nDataType : 0,   // (0: XML타입, 1: 이진 타입, 2: SSV 타입)
				bCompress :false,	 //			  
				}; 
			
		//공통 transaction 함수 호츨   //function callback 
		Iject.transaction(this,oDatas,function(){   
			if(this.errorcode < 0)
			{
			Iject.alert(this.errorMsg,"알림");			
			return;
			}			
	      
			var pThis = this.fobj;   //form object
	       
			
			var svcid_id = this.svcid.split("_",3);
			var svcid_idx = svcid_id.length;
			var svc = svcid_id[svcid_idx-1];
			switch(svc)
			{
				case "save" : 
					Iject.alert("저장완료");
					break;
				
				case "delete" : 
					Iject.alert("삭제완료");
					break; 
			}
			pThis.fn_search_onclick();
	      
	    
		});
	}else{
		rowNum = this.ds_user.rowposition;
		this.fn_search_onclick();
	}
	//this.fn_search_onclick();
}

//삭제
this.btn_btr_delete_onclick = function(obj:Button, e:nexacro.ClickEventInfo)
{
	var nRow = this.ds_user.rowposition;
	this.ds_user.deleteRow(nRow);
	//var rtnValue = Iject.confirm("삭제 하시겠습니까?");
	
// 	
// 	  var searchCondition =  "NAME";
//     var searchKeyword = this.edt_btrip_dno.value;       
// 	this.ds_search.setColumn(0, "searchCondition", "NAME");
// 	this.ds_search.setColumn(0, "searchKeyword", searchKeyword);
//    
  
	
// 	if(rtnValue){
// 		this.fn_save("delete");
// 	}else{
// 		this.fn_search_onclick();
// 	}
	this.fn_save("delete");
}
// 추가
this.btn_btr_add_onclick = function(obj:Button, e:nexacro.ClickEventInfo)
{
	var imsi = this.edt_btr_mNum.value;
	var nRow = this.ds_user.addRow();
	
	this.edt_btr_mNum.set_value(imsi);
	this.ds_user.setColumn(this.ds_user.rowposition, "btrip_Dno", this.edt_btr_mNum.value);
}
]]></Script>
  </Form>
</FDL>
